# 계산엔진 스펙 v1 (적립/인출/물가/세금)

## 1) 목적
은퇴 전 적립기 + 은퇴 후 인출기를 하나의 엔진으로 계산해
"목표생활비 충족 가능성"과 "부족분/조정안"을 제공한다.

## 2) 입력
- 현재나이, 은퇴나이, 기대수명
- 현재자산(투자/현금 분리)
- 월 적립금, 연 적립증가율
- 은퇴 후 월 지출(현재가치)
- 기대수익률(명목), 변동성(옵션), 물가상승률
- 세금 가정(과세율/비과세 비중)
- 연금/기타 고정 현금유입

## 3) 핵심 계산
### A. 적립기 (현재~은퇴전)
연단위 자산 진화:
A(t+1) = (A(t) + C(t)) * (1 + r_after_tax(t))
- C(t): 연 적립 총액
- r_after_tax: 세후 수익률

### B. 인출기 (은퇴후)
A(t+1) = (A(t) - W(t) + P(t)) * (1 + r_after_tax(t))
- W(t): 연 지출 (물가 반영)
- P(t): 연금/기타 현금유입

### C. 물가 반영
- 지출: W(t)=W0*(1+infl)^t
- 목표자산 환산 시 실질/명목 선택 지원

### D. 세금 반영(단순모형 v1)
- r_after_tax = r_nominal * (1 - tax_drag)
- tax_drag는 계좌유형 비중으로 가중

## 4) 시나리오
- 보수: 수익률 낮음/물가 높음
- 중립: 기준값
- 낙관: 수익률 높음/물가 낮음
- 옵션: 몬테카를로(정규분포 기반) 1,000회

## 5) 출력
- 은퇴시점 예상 자산(구간)
- 은퇴기간 자금 고갈 확률
- 목표생활비 충족 확률
- 부족자금(현재가치/명목가치)
- 조정안 3종:
  1) 월 적립 +X
  2) 은퇴시점 +Y년
  3) 지출 -Z%

## 6) 검증 규칙
- 입력 누락/범위 오류 방지
- 극단값 경고 (예: 물가>8%, 인출률>8%)
- 결과 민감도(수익률 ±1%, 물가 ±1%) 함께 표시

## 7) v1 제약
- 자산군별 상관/리밸런싱 상세모형 미포함
- 세금은 단순화(정교 세제모형은 v1.2)

## 8) API 계약(초안)
- `POST /simulate`
- request: inputs + scenarioMode
- response: summary + yearlySeries + diagnostics
